{% extends "base.html" %}
{% block title %}Gesti√≥n de Placas{% endblock %}
{% block content %}

<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold">üöõ Placas registradas</h2>

    <!-- ‚úÖ √öNICO BOT√ìN EDITAR -->
    <button id="btnEditar" class="btn btn-outline-primary">
      ‚úèÔ∏è Editar
    </button>
  </div>

  {% if placas %}
  <form method="POST" action="{{ url_for('placa_bp.actualizar_placas_batch') }}">

    <div class="table-responsive">
      <table class="table table-hover align-middle shadow-sm" id="tablaPlacas">
        <thead class="table-primary">
          <tr>
            <th>ID</th>
            <th>N√∫mero de placa</th>
            <th>Chofer</th>
            <th>Color cabezal</th>
            <th>Registrado por</th>
            <th>Fecha de registro</th>
            <th>Estado</th>
          </tr>
        </thead>

        <tbody>
          {% for placa in placas %}
          <tr class="fila-placa">
            <td>{{ placa.id }}</td>
            <td class="fw-bold">{{ placa.numero_placa }}</td>

            <td>
              <input type="text"
                     name="propietario[{{ placa.id }}]"
                     class="form-control form-control-sm editable"
                     value="{{ placa.propietario or '' }}"
                     disabled>
            </td>

            <td>
              <input type="text"
                     name="color_cabezal[{{ placa.id }}]"
                     class="form-control form-control-sm editable"
                     value="{{ placa.color_cabezal or '' }}"
                     disabled>
            </td>

            <td>{{ placa.usuario.nombre if placa.usuario else '‚Äî' }}</td>
            <td>{{ placa.fecha_registro.strftime('%d/%m/%Y %H:%M') }}</td>

            <td>
              <select name="estado[{{ placa.id }}]"
                      class="form-select form-select-sm editable"
                      disabled>
                <option value="Activa" {% if placa.estado == 'Activa' %}selected{% endif %}>Activa</option>
                <option value="Inactiva" {% if placa.estado == 'Inactiva' %}selected{% endif %}>Inactiva</option>
              </select>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ‚úÖ √öNICO BOT√ìN GUARDAR -->
    <div class="d-flex justify-content-end mt-3">
      <button id="btnGuardar" type="submit" class="btn btn-success d-none">
        üíæ Guardar cambios
      </button>
    </div>

  </form>
  {% else %}
  <div class="alert alert-info text-center mt-4">
    No hay placas registradas a√∫n.
  </div>
  {% endif %}
</div>

<!-- ‚úÖ JS M√çNIMO: editar / guardar -->
<script>
const btnEditar = document.getElementById("btnEditar");
const btnGuardar = document.getElementById("btnGuardar");
const editables = document.querySelectorAll(".editable");

btnEditar.addEventListener("click", () => {
  editables.forEach(el => el.disabled = false);
  btnGuardar.classList.remove("d-none");
  btnEditar.disabled = true;
});
</script>

{% endblock %}